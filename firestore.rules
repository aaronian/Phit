rules_version = '2';

/**
 * Firestore Security Rules for Phit
 *
 * Structure:
 *   users/{userId}/
 *     ├── preferences/settings   - User preferences document
 *     ├── templates/{templateId} - Custom workout templates
 *     └── sessions/{sessionId}   - Completed workout sessions
 *
 * Auth: Users can only read/write their own data.
 * The userId in the path must match request.auth.uid (Clerk user ID via custom token).
 */

service cloud.firestore {
  match /databases/{database}/documents {

    // Users can only access their own data
    match /users/{userId}/{document=**} {
      // User must be authenticated
      allow read, write: if request.auth != null
                         && request.auth.uid == userId;
    }

    // Deny all other access by default
    match /{document=**} {
      allow read, write: if false;
    }
  }
}
